<%- include('../layouts/header.ejs') %>

  <!-- page loader start -->
  <div id="preLoader" style="width: 100%;height: 100vh;padding-top: 35vh; background-color: #000;">
    <img class="img-fluid" style="width: 15%;display: block;margin-left:auto;margin-right: auto;"
      src="/public/images/loader-trans.gif">
  </div>

  <!-- page loader ends  -->
  <script>

    let loader = document.getElementById("preLoader")
    window.addEventListener("load", function () {
      loader.style.display = "none";
    })

  </script>


  <!-- Start Header/Navigation -->
  <nav class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark" arial-label="Furni navigation bar">

    <div class="container">
      <a class="navbar-brand" href="/">Furni<span>.</span></a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni"
        aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarsFurni">
        <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
          <li class="nav-item ">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li><a class="nav-link" href="/shop">Shop</a></li>
          <li><a class="nav-link" href="/about">About us</a></li>
          <li><a class="nav-link" href="/services">Services</a></li>
          <li><a class="nav-link" href="/blog">Blog</a></li>
          <li><a class="nav-link" href="/contact">Contact us</a></li>
        </ul>

        <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
          <li><a class="nav-link" href="/user"><img src="/public/images/user.svg"></a></li>
          <li><a class="nav-link" href="#"><img src="/public/images/heart.png"></a></li>
          <li><a class="nav-link" href="/cart"><img src="/public/images/cart.svg"></a></li>
        </ul>
      </div>
    </div>

  </nav>
  <!-- End Header/Navigation -->

  <!-- Start Hero Section -->
  <div class="hero">
    <div class="container">
      <div class="row justify-content-between">
        <div class="col-lg-5">
          <div class="intro-excerpt">
            <h1>Wish List</h1>
          </div>
        </div>
        <div class="col-lg-7">

        </div>
      </div>
    </div>
  </div>
  <!-- End Hero Section -->



  <div class="untree_co-section before-footer-section">
    <div class="container">
      <div class="row mb-5">
        <form class="col-md-12" method="post">
          <div class="site-blocks-table">
            <table class="table">
              <thead>
                <tr>
                  <th class="product-thumbnail">Image</th>
                  <th class="product-name">Product</th>
                  <th class="product-price">Price</th>
                  <th class="product-status">Status</th>
                  <th class="product-remove">Action</th>
                  <th class="product-action">Remove</th>



                </tr>
              </thead>
              <% console.log(wishlist,'it is wddddd') %>
                <% if(wishlist.length> 0) { %>
                  <% wishlist[0].products.forEach((product,index)=>{ %>
                    <tbody id="wishlist-item-<%= index %>">

                      <tr>
                        <td class="product-thumbnail">
                          <img src="/public/productImages/<%= product.productId.image[0]%>" alt="Image"
                            class="img-fluid">
                        </td>
                        <td class="product-name">
                          <h2 class="h5 text-black">
                            <%= product.productId.name %>
                          </h2>
                        </td>
                        <td style="font-weight: 700; font-size: medium;">
                          <%= product.productId.price %>
                        </td>

                        <!-- <input type="hidden" name="id"> -->
                        <%if(product.productId.quantity>0){ %>

                          <td class="stock-col text-success" style="font-size: large;"><span
                              class="in-stock">Available</span></td>
                          <% }else{ %>

                            <td class="stock-col"><span class="in-stock text-danger" style="font-size: medium;">Out of
                                Stock</span></td>
                            <% } %>
                              <td class="action-col">
                                <%if(product.productId.quantity>0){ %>

                                  <button class="btn btn-block btn-outline-primary-2"
                                    onclick="addCart('<%= product.productId._id %>')"><i class="icon-cart-plus"></i>Add
                                    to
                                    Cart</button>
                                  <% }%>
                              </td>
                              <td class="remove-col">
                                <button type="button" onclick="remove('<%= product._id %>','<%= index %>')"
                                  class="btn btn-remove ">
                                  <i class="icon-close"></i>X
                                </button>
                              </td>
                      </tr>
                      <% }) %>
                        <% } %>
                    </tbody>
            </table>
          </div>
        </form>
      </div>

      <!-- <div id="cartTotalContainer">
        <h3>Total: <span id="cartTotal" class="cartTotal">$0.00</span></h3>
    </div> -->

    </div>
  </div>


  <!-- Start Footer Section -->
  <footer class="footer-section">
    <div class="container relative">

      <div class="sofa-img">
        <img src="/public/images/sofa.png" alt="Image" class="img-fluid">
      </div>


      <div class="row g-5 mb-5">
        <div class="col-lg-4">
          <div class="mb-4 footer-logo-wrap"><a href="#" class="footer-logo">Furni<span>.</span></a></div>
          <p class="mb-4">Donec facilisis quam ut purus rutrum lobortis. Donec vitae odio quis nisl dapibus malesuada.
            Nullam ac aliquet velit. Aliquam vulputate velit imperdiet dolor tempor tristique. Pellentesque habitant</p>

          <ul class="list-unstyled custom-social">
            <li><a href="http://www.facebook.com"><span class="fa fa-brands fa-facebook-f"></span></a></li>
            <li><a href="http://www.twitter.com"><span class="fa fa-brands fa-twitter"></span></a></li>
            <li><a href="http://www.instagram.com"><span class="fa fa-brands fa-instagram"></span></a></li>
            <li><a href="http://www.linkedin.com"><span class="fa fa-brands fa-linkedin"></span></a></li>
          </ul>
        </div>

        <div class="col-lg-8">
          <div class="row links-wrap">
            <div class="col-6 col-sm-6 col-md-3">
              <ul class="list-unstyled">
                <li><a href="#">About us</a></li>
                <li><a href="#">Services</a></li>
                <li><a href="#">Blog</a></li>
                <li><a href="#">Contact us</a></li>
              </ul>
            </div>

            <div class="col-6 col-sm-6 col-md-3">
              <ul class="list-unstyled">
                <li><a href="#">Support</a></li>
                <li><a href="#">Knowledge base</a></li>
                <li><a href="#">Live chat</a></li>
              </ul>
            </div>

            <div class="col-6 col-sm-6 col-md-3">
              <ul class="list-unstyled">
                <li><a href="#">Jobs</a></li>
                <li><a href="#">Our team</a></li>
                <li><a href="#">Leadership</a></li>
                <li><a href="#">Privacy Policy</a></li>
              </ul>
            </div>

            <div class="col-6 col-sm-6 col-md-3">
              <ul class="list-unstyled">
                <li><a href="#">Nordic Chair</a></li>
                <li><a href="#">Kruzo Aero</a></li>
                <li><a href="#">Ergonomic Chair</a></li>
              </ul>
            </div>
          </div>
        </div>

      </div>

      <div class="border-top copyright">
        <div class="row pt-4">
          <div class="col-lg-6">
            <p class="mb-2 text-center text-lg-start">Copyright &copy;
              <script>document.write(new Date().getFullYear());</script>. All Rights Reserved. &mdash; Designed with
              love by <a href="https://untree.co">Untree.co</a> Distributed By <a
                hreff="https://themewagon.com">ThemeWagon</a> <!-- License information: https://untree.co/license/ -->
            </p>
          </div>

          <div class="col-lg-6 text-center text-lg-end">
            <ul class="list-unstyled d-inline-flex ms-auto">
              <li class="me-4"><a href="#">Terms &amp; Conditions</a></li>
              <li><a href="#">Privacy Policy</a></li>
            </ul>
          </div>

        </div>
      </div>

    </div>
  </footer>
  <!-- End Footer Section -->

  <script>

    function addCart(productId) {
      event.preventDefault();
      console.log('its getting the result', productId);

      let quantity = 1;

      fetch(`/addToCart/${productId}/${quantity}`, {
        method: "GET",
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response is not OK');
          }
          return response.json();
        })
        .then(data => {
          if (data.status === true) {
            Swal.fire({
              icon: "success",
              title: "Your Product has been added",
              showConfirmButton: false,
              timer: 1500,
            })
          } else {
            Swal.fire({
              title: 'Item already in your Cart',
              text: 'You already added this item to the product',
              icon: 'info',
              confirmButtonText: 'Ok'
            })
          }
        })
        .catch(error => {
          console.log('it is got');
          console.error('Error :', error);
        })
    }

    function remove(productId, index) {
      Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
      }).then((result) => {
        if (result.isConfirmed) {
          axios.post(`/removeWishlist/${productId}`)
            .then(response => {
              if (response.data.removed) {
                document.getElementById(`wishlist-item-${index}`).remove();
                Swal.fire(
                  'Deleted!',
                  'Your item has been deleted.',
                  'success'
                );
              }
            })
            .catch(error => {
              console.log('its error:', error);
            });
        }
      });
    }


  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <%- include('../layouts/footer.ejs') %>